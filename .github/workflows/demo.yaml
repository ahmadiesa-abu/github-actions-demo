name: just a simple demo for cli action
on:
  workflow_dispatch:
    inputs:
      secret_name:
        required: true
        description: 'secert key that contians the json'  
      json_key:
         required: true
         description: 'key to parse from the secret json'       
jobs:
  test_job:
    runs-on: ubuntu-latest
    environment: manager-oversight
    steps:
      - name: Run some command
        id: get_secert_step
        uses: cloudify-cosmo/cli-action@v1.2
        with:
          command: "secrets get --json ${{ github.event.inputs.secret_name }}" 
          set-output: false
      - name: Get Deployment ID
        shell: bash
        run: |
          key_val=${{github.event.inputs.json_key}}
          echo "${{fromJSON(steps.get_secert_step.outputs.cli-output).`$key_val`}}"
          
env:
  CLOUDIFY_HOST: ${{ secrets.CLOUDIFY_HOST }}
  CLOUDIFY_USERNAME: ${{ secrets.CLOUDIFY_USERNAME }}
  CLOUDIFY_PASSWORD: ${{ secrets.CLOUDIFY_PASSWORD }}
  CLOUDIFY_TENANT: ${{ secrets.CLOUDIFY_TENANT }}
  CLOUDIFY_SSL: ${{ secrets.CLOUDIFY_SSL }}
